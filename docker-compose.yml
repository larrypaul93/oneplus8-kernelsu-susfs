services:
  kernel-builder:
    build:
      context: .
      dockerfile: Dockerfile
    image: oneplus-kernel-builder
    container_name: kernel-build
    volumes:
      - ./output:/output
      - ccache:/root/.ccache
    environment:
      # Kernel source configuration - Official LineageOS
      - KERNEL_SOURCE=https://github.com/LineageOS/android_kernel_oneplus_sm8250.git
      - KERNEL_BRANCH=lineage-23.0
      - DEFCONFIG=vendor/kona-perf_defconfig
      - DEVICE_NAME=OnePlus8_Series
      # KernelSU variant: ksu, sukisu, next, rsuntk
      - KERNELSU_VARIANT=ksu
      # Enable SUSFS patches (disabled for now - patch compatibility issues)
      - SUSFS_ENABLED=false
      # Patches repo
      - PATCHES_REPO=JackA1ltman/NonGKI_Kernel_Patches
      - PATCHES_BRANCH=op_kernel
      # Build optimizations
      - CCACHE_DIR=/root/.ccache
      - USE_CCACHE=1
    tty: true
    stdin_open: true

volumes:
  ccache:
